var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,n=(s,r,o)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,p=(e,s)=>{var r={};for(var n in e)a.call(e,n)&&s.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&o)for(var n of o(e))s.indexOf(n)<0&&t.call(e,n)&&(r[n]=e[n]);return r};import{d as l,an as i,C as c,b as f,g as u,w as m,D as d,z as h,E as g,q as y,M as b,B as v,ar as O,aa as w,ae as j,at as x,i as P}from"./index-CO5J-Q2S.js";import{o as E,b as k,F as C,c as T}from"./page-wraper.Di0VYMXm.js";import{u as q}from"./useChildren.Dtl4IwbD.js";const B=l((D=((e,s)=>{for(var r in s||(s={}))a.call(s,r)&&n(e,r,s[r]);if(o)for(var r of o(s))t.call(s,r)&&n(e,r,s[r]);return e})({},{name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),I={props:E,setup(e,{expose:s}){const{show:r}=k("wd-form-toast"),o=e,{children:a,linkChildren:t}=q(C);let n=i({});function l(e){e?n[e]="":Object.keys(n).forEach((e=>{n[e]=""}))}return t({props:o,errorMessages:n}),c((()=>o.model),(()=>{o.resetOnChange&&l()}),{immediate:!0,deep:!0}),s({validate:function(e){return s=this,t=null,i=function*(){const s=[];let t=!0;const i=[],c=function(){const e=x(o.rules),s=a.map((e=>e.prop));return Object.keys(e).forEach((r=>{s.includes(r)||delete e[r]})),a.forEach((s=>{v(s.prop)&&v(s.rules)&&s.rules.length&&(e[s.prop]?e[s.prop]=[...e[s.prop],...s.rules]:e[s.prop]=s.rules)})),e}(),f=b(e)?e:v(e)?[e]:[],u=f.length>0?f.reduce(((e,s)=>(c[s]&&(e[s]=c[s]),e)),{}):c;for(const e in u){const r=u[e],a=O(o.model,e);if(r&&r.length>0)for(const o of r){if(o.required&&(!v(a)||""===a)){s.push({prop:e,message:o.message}),t=!1;break}if(o.pattern&&!o.pattern.test(a)){s.push({prop:e,message:o.message}),t=!1;break}const r=o,{validator:n}=r,l=p(r,["validator"]);if(n){const r=n(a,l);w(r)?i.push(r.then((r=>{"string"==typeof r?(s.push({prop:e,message:r}),t=!1):"boolean"!=typeof r||r||(s.push({prop:e,message:o.message}),t=!1)})).catch((r=>{const a=v(r)?j(r)?r:r.message||o.message:o.message;s.push({prop:e,message:a}),t=!1}))):r||(s.push({prop:e,message:o.message}),t=!1)}}}return yield Promise.all(i),function(e){const s=a.map((e=>e.prop)).filter(Boolean),t=e.filter((e=>e.message&&s.includes(e.prop)));t.length&&(t.sort(((e,r)=>s.indexOf(e.prop)-s.indexOf(r.prop))),"toast"===o.errorType?r(t[0].message):"message"===o.errorType&&t.forEach((e=>{n[e.prop]=e.message})))}(s),t&&(f.length?f.forEach(l):l()),{valid:t,errors:s}},new Promise(((e,r)=>{var o=e=>{try{n(i.next(e))}catch(s){r(s)}},a=e=>{try{n(i.throw(e))}catch(s){r(s)}},n=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,a);n((i=i.apply(s,t)).next())}));var s,t,i},reset:function(){l()}}),(e,s)=>{const r=P;return u(),f(r,{class:y(`wd-form ${e.customClass}`),style:g(e.customStyle)},{default:m((()=>[d(e.$slots,"default"),"toast"===o.errorType?(u(),f(T,{key:0,selector:"wd-form-toast"})):h("",!0)])),_:3},8,["class","style"])}}},s(D,r(I))));var D,I;export{B as _};
