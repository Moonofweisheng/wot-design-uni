var e=Object.defineProperty,s=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,o,a)=>o in s?e(s,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[o]=a,r=(e,s)=>{for(var o in s||(s={}))t.call(s,o)&&i(e,o,s[o]);if(a)for(var o of a(s))l.call(s,o)&&i(e,o,s[o]);return e},n=(e,a)=>s(e,o(a));import{d as u,r as c,aj as d,b as p,z as f,g as m,w as v,h as _,i as y,L as w,aW as b,G as h,q as g,aD as k,c as C,I as x,m as P,F as L,n as I,E as T,p as j,j as D,t as F,k as z,l as K,C as O,at as S,aX as E,aY as U,aZ as M,x as N,J as $,a1 as G,ai as R,au as A,a8 as H}from"./index-Bxqg77pZ.js";import{c as q,a as J,_ as V}from"./base64.C49xnrUQ.js";import{n as W,j as X}from"./page-wraper.dVabujC3.js";import{u as Y}from"./useTranslate.CsR2puND.js";import{a as Z,u as B}from"./types.BlEgWvRU.js";const Q=r({},q),ee=V(u(n(r({},{name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:Q,setup(e,{expose:s}){const o=c(!1),a=d({url:"",poster:"",title:""});function t(){o.value=!1,k((()=>{a.url="",a.poster="",a.title=""}))}return W((()=>o.value)),s({open:function(e){o.value=!0,a.url=e.url,a.poster=e.poster,a.title=e.title},close:t}),(e,s)=>{const l=b,i=y;return o.value?(m(),p(i,{key:0,class:g(`wd-video-preview ${e.customClass}`),style:h(e.customStyle),onClick:t},{default:v((()=>[_(i,{class:"wd-video-preview__video",onClick:s[0]||(s[0]=w((()=>{}),["stop"]))},{default:v((()=>[a.url?(m(),p(l,{key:0,class:"wd-video-preview__video",controls:!0,poster:a.poster,title:a.title,"play-btn-position":"center",enableNative:!0,src:a.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):f("",!0)])),_:1}),_(J,{name:"close","custom-class":"wd-video-preview__close",onClick:t})])),_:1},8,["class","style"])):f("",!0)}}})),[["__scopeId","data-v-ea4379c2"]]),se=V(u(n(r({},{name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:Z,emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:s,emit:o}){const a=e,t=o;s({submit:()=>Z(),abort:()=>k()});const{translate:l}=Y("upload"),i=c([]),u=C((()=>!a.limit||i.value.length<a.limit)),d=c(),{startUpload:w,abort:k,chooseFile:q,UPLOAD_STATUS:V}=B();function W(){t("update:fileList",i.value)}function Z(){const{buildFormData:e,formData:s={},statusKey:o}=a,{action:t,name:l,header:r={},accept:n,successStatus:u,uploadMethod:c}=a,d=O(u)?u:200;for(const a of i.value)a[o]===V.PENDING&&(e?e({file:a,formData:s,resolve:e=>{e&&w(a,{action:t,header:r,name:l,formData:e,fileType:n,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:ae,onError:oe,onProgress:te})}}):w(a,{action:t,header:r,name:l,formData:s,fileType:n,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:ae,onError:oe,onProgress:te}))}function Q(e){return new Promise(((s,o)=>{G({src:e,success:e=>{s(e)},fail:e=>{o(e)}})}))}function se(e,s){const{statusKey:o}=a,t={uid:R.id++,name:e.name||"",thumb:e.thumb||"",[o]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?i.value.splice(s,1,t):i.value.push(t),a.autoUpload&&Z()}function oe(e,s,o){const{statusKey:l}=a,r=i.value.findIndex((e=>e.uid===s.uid));r>-1&&(i.value[r][l]="fail",i.value[r].error=e.message,i.value[r].response=e,t("fail",{error:e,file:s,formData:o}),W())}function ae(e,s,o){const{statusKey:l}=a,r=i.value.findIndex((e=>e.uid===s.uid));r>-1&&(i.value[r][l]="success",i.value[r].response=e.data,t("change",{fileList:i.value}),t("success",{file:s,fileList:i.value,formData:o}),W())}function te(e,s){const o=i.value.findIndex((e=>e.uid===s.uid));o>-1&&(i.value[o].percent=e.progress,t("progress",{response:e,file:s}))}function le(e){const{multiple:s,maxSize:o,accept:l,sizeType:r,limit:n,sourceType:u,compressed:c,maxDuration:d,camera:p,beforeUpload:f,extension:m}=a;q({multiple:!O(e)&&s,sizeType:r,sourceType:u,maxCount:n?n-i.value.length:n,accept:l,compressed:c,maxDuration:d,camera:p,extension:m}).then((a=>{let l=a;s||(l=l.slice(0,1));const r=s=>{return a=this,l=null,i=function*(){for(let a=0;a<s.length;a++){const l=s[a];if("image"===l.type&&!l.size){const e=yield Q(l.path);l.size=e.width*e.height}Number(l.size)<=o?se(l,e):t("oversize",{file:l})}},new Promise(((e,s)=>{var o=e=>{try{r(i.next(e))}catch(o){s(o)}},t=e=>{try{r(i.throw(e))}catch(o){s(o)}},r=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,t);r((i=i.apply(a,l)).next())}));var a,l,i};f?f({files:l,fileList:i.value,resolve:e=>{e&&r(l)}}):r(l)})).catch((e=>{t("chooseerror",{error:e})}))}function ie(){re()}function re(e){if(a.disabled)return;const{beforeChoose:s}=a;s?s({fileList:i.value,resolve:s=>{s&&le(e)}}):le(e)}function ne(e){i.value.splice(i.value.findIndex((s=>s.uid===e.uid)),1),t("change",{fileList:i.value}),t("remove",{file:e}),W()}function ue(e){M({filePath:e.url,showMenu:!0})}function ce(e,s){const{onPreviewFail:o}=a;N({urls:s,current:s[e],fail(){o?o({index:e,imgList:s}):$({title:"预览图片失败",icon:"none"})}})}function de(e,s){var o;const{onPreviewFail:t}=a;null==(o=d.value)||o.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function pe(e){const{beforePreview:s,reupload:o}=a,t=S(i.value),l=t.findIndex((s=>s.url===e.url)),r=t.filter((e=>fe(e))),n=r.findIndex((s=>s.url===e.url));o?re(l):s?s({file:e,index:l,imgList:[],fileList:t,resolve:e=>{e&&de(n,r)}}):de(n,r)}function fe(e){return e.name&&E(e.name)||E(e.url)}function me(e){return e.name&&U(e.name)||U(e.url)}return x((()=>a.fileList),(e=>{const{statusKey:s}=a;if(A(e,i.value))return;const o=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",n(r({},e),{uid:R.id++}))));i.value=o}),{deep:!0,immediate:!0}),x((()=>a.limit),(e=>{e&&e<i.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),x((()=>a.beforePreview),(e=>{e&&!H(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),x((()=>a.onPreviewFail),(e=>{e&&!H(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),x((()=>a.beforeRemove),(e=>{e&&!H(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),x((()=>a.beforeUpload),(e=>{e&&!H(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),x((()=>a.beforeChoose),(e=>{e&&!H(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),x((()=>a.buildFormData),(e=>{e&&!H(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const o=j,t=y,r=b,n=z;return m(),P(L,null,[_(t,{class:g(["wd-upload",e.customClass]),style:h(e.customStyle)},{default:v((()=>[(m(!0),P(L,null,I(i.value,((s,u)=>(m(),p(t,{class:g(["wd-upload__preview",e.customPreviewClass]),key:u},{default:v((()=>[_(t,{class:"wd-upload__status-content"},{default:v((()=>[me(s)?(m(),p(o,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:o}=a,t=S(i.value),l=t.findIndex((s=>s.url===e.url)),r=t.filter((e=>me(e))).map((e=>e.url)),n=r.findIndex((s=>s===e.url));o?re(l):s?s({file:e,index:l,fileList:t,imgList:r,resolve:e=>{e&&ce(n,r)}}):ce(n,r)}(s)},null,8,["src","mode","onClick"])):fe(s)?(m(),P(L,{key:1},[s.thumb?(m(),p(t,{key:0,class:"wd-upload__video",onClick:e=>pe(s)},{default:v((()=>[_(o,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),_(J,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(m(),p(t,{key:1,class:"wd-upload__video",onClick:e=>pe(s)},{default:v((()=>[_(r,{src:s.url,title:s.name||"视频"+u,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),_(J,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(m(),p(t,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:o}=a,t=S(i.value),l=t.findIndex((s=>s.url===e.url));o?re(l):s?s({file:e,index:l,imgList:[],fileList:t,resolve:s=>{s&&ue(e)}}):ue(e)}(s)},{default:v((()=>[_(J,{name:"file","custom-class":"wd-upload__file-icon"}),_(t,{class:"wd-upload__file-name"},{default:v((()=>[D(F(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[a.statusKey]?(m(),p(t,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:v((()=>["loading"===s[a.statusKey]?(m(),p(t,{key:0,class:"wd-upload__status-content"},{default:v((()=>[_(X,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),_(n,{class:"wd-upload__progress-txt"},{default:v((()=>[D(F(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):f("",!0),"fail"===s[a.statusKey]?(m(),p(t,{key:1,class:"wd-upload__status-content"},{default:v((()=>[_(J,{name:"close-outline","custom-class":"wd-upload__icon"}),_(n,{class:"wd-upload__progress-txt"},{default:v((()=>[D(F(s.error||K(l)("error")),1)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1024)):f("",!0),"loading"===s[a.statusKey]||e.disabled?f("",!0):(m(),p(J,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=a,o=e,t=i.value[o];s?s({file:t,index:o,fileList:i.value,resolve:e=>{e&&ne(t)}}):ne(t)}(u)},null,8,["onClick"])),e.$slots["preview-cover"]?T(e.$slots,"preview-cover",{key:2,file:s,index:u},void 0,!0):f("",!0)])),_:2},1032,["class"])))),128)),u.value?(m(),P(L,{key:0},[e.$slots.default?(m(),p(t,{key:0,class:g(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:ie},{default:v((()=>[T(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(m(),p(t,{key:1,onClick:ie,class:g(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:v((()=>[_(J,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(m(),p(t,{key:0,class:"wd-upload__evoke-num"},{default:v((()=>[D("（"+F(i.value.length)+"/"+F(e.limit)+"）",1)])),_:1})):f("",!0)])),_:1},8,["class"]))],64)):f("",!0)])),_:3},8,["class","style"]),_(ee,{ref_key:"videoPreview",ref:d},null,512)],64)}}})),[["__scopeId","data-v-0f2afe0a"]]);export{se as _};
