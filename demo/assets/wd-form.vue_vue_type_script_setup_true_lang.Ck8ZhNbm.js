var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,p=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,n=(e,s)=>{var r={};for(var p in e)o.call(e,p)&&s.indexOf(p)<0&&(r[p]=e[p]);if(null!=e&&a)for(var p of a(e))s.indexOf(p)<0&&t.call(e,p)&&(r[p]=e[p]);return r};import{d as l,aj as c,I as i,b as f,g as u,w as m,E as d,z as g,G as h,q as y,N as b,C as v,ar as O,aa as w,ag as j,at as x,i as P}from"./index-Bxqg77pZ.js";import{p as E,d as k,c as C,F as I,e as T}from"./page-wraper.dVabujC3.js";const q=l((G=((e,s)=>{for(var r in s||(s={}))o.call(s,r)&&p(e,r,s[r]);if(a)for(var r of a(s))t.call(s,r)&&p(e,r,s[r]);return e})({},{name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),S={props:E,setup(e,{expose:s}){const{show:r}=k("wd-form-toast"),a=e,{children:o,linkChildren:t}=C(I);let p=c({});function l(e){e?p[e]="":Object.keys(p).forEach((e=>{p[e]=""}))}return t({props:a,errorMessages:p}),i((()=>a.model),(()=>{a.resetOnChange&&l()}),{immediate:!0,deep:!0}),s({validate:function(e){return s=this,t=null,c=function*(){const s=[];let t=!0;const c=[],i=function(){const e=x(a.rules),s=o.map((e=>e.prop));return Object.keys(e).forEach((r=>{s.includes(r)||delete e[r]})),o.forEach((s=>{v(s.prop)&&v(s.rules)&&s.rules.length&&(e[s.prop]?e[s.prop]=[...e[s.prop],...s.rules]:e[s.prop]=s.rules)})),e}(),f=b(e)?e:v(e)?[e]:[],u=f.length>0?f.reduce(((e,s)=>(i[s]&&(e[s]=i[s]),e)),{}):i;for(const e in u){const r=u[e],o=O(a.model,e);if(r&&r.length>0)for(const a of r){if(a.required&&(!v(o)||""===o)){s.push({prop:e,message:a.message}),t=!1;break}if(a.pattern&&!a.pattern.test(o)){s.push({prop:e,message:a.message}),t=!1;break}const r=a,{validator:p}=r,l=n(r,["validator"]);if(p){const r=p(o,l);w(r)?c.push(r.then((r=>{"string"==typeof r?(s.push({prop:e,message:r}),t=!1):"boolean"!=typeof r||r||(s.push({prop:e,message:a.message}),t=!1)})).catch((r=>{const o=v(r)?j(r)?r:r.message||a.message:a.message;s.push({prop:e,message:o}),t=!1}))):r||(s.push({prop:e,message:a.message}),t=!1)}}}return yield Promise.all(c),function(e){const s=o.map((e=>e.prop)).filter(Boolean),t=e.filter((e=>e.message&&s.includes(e.prop)));t.length&&(t.sort(((e,r)=>s.indexOf(e.prop)-s.indexOf(r.prop))),"toast"===a.errorType?r(t[0].message):"message"===a.errorType&&t.forEach((e=>{p[e.prop]=e.message})))}(s),t&&(f.length?f.forEach(l):l()),{valid:t,errors:s}},new Promise(((e,r)=>{var a=e=>{try{p(c.next(e))}catch(s){r(s)}},o=e=>{try{p(c.throw(e))}catch(s){r(s)}},p=s=>s.done?e(s.value):Promise.resolve(s.value).then(a,o);p((c=c.apply(s,t)).next())}));var s,t,c},reset:function(){l()}}),(e,s)=>{const r=P;return u(),f(r,{class:y(`wd-form ${e.customClass}`),style:h(e.customStyle)},{default:m((()=>[d(e.$slots,"default"),"toast"===a.errorType?(u(),f(T,{key:0,selector:"wd-form-toast"})):g("",!0)])),_:3},8,["class","style"])}}},s(G,r(S))));var G,S;export{q as _};
