var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a)=>{for(var l in a||(a={}))u.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&s(e,l,a[l]);return e},c=(e,t)=>a(e,l(t));import{d as n,r,Z as v,_ as m,K as d,I as p,c as h,D as g,H as f,b as w,z as y,g as _,w as b,h as x,i as k,G as S,q as j,p as C,$ as T,j as $,t as M,l as P,a0 as V,a1 as I,a2 as N,u as F,e as O,f as z,m as H,F as q,n as R,a3 as U}from"./index-Bxqg77pZ.js";import{c as W,m as Y,d as D,b as X,e as B,a as E,_ as A}from"./base64.C49xnrUQ.js";import{_ as G}from"./wd-button.Dfw0jUO9.js";import{u as L}from"./useTranslate.CsR2puND.js";import{_ as K}from"./wd-img.dFpO45GZ.js";import{_ as Z}from"./demo-block.Q9ikF_jn.js";import{d as J,a as Q}from"./page-wraper.dVabujC3.js";import{u as ee}from"./types.BlEgWvRU.js";const ae=c(i({},W),{modelValue:B(!1),cancelButtonText:String,confirmButtonText:String,disabledRotate:B(!1),fileType:Y("png"),quality:D(1),exportScale:D(2),imgSrc:Y(""),imgWidth:X(""),imgHeight:X(""),maxScale:D(3),aspectRatio:Y("1:1")}),le=A(n(c(i({},{name:"wd-img-cropper",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:ae,emits:["imgloaded","imgloaderror","cancel","confirm","update:modelValue"],setup(e,{expose:a,emit:l}){const t=r(`cropper${v()}`);let u=null,o=null,s=!0,i=null,c=null;const n=.85,F=e,O=l,{translate:z}=L("img-cropper"),H=r(0),q=r(!1),R=r(0),U=r(0),W=r(0),Y=r(0),D=r(20),X=r(0),B=r(0),A=r(""),K=r(""),Z=r(2),J=r(1),Q=r(m().windowWidth/2),ee=r(m().windowHeight/2*n),ae=r(null),le=r(m()),te=r(!0),ue=r([{x:"",y:""},{x:"",y:""}]),oe=r(""),se=r(null),{proxy:ie}=d();p((()=>F.modelValue),(e=>{if(e){i=F.imgWidth,c=F.imgHeight,le.value=m();const[e,a]=F.aspectRatio.split(":").map(Number),l=le.value.windowWidth-2*D.value,u=l*a/e;W.value=l,Y.value=u,B.value=(le.value.windowHeight*n-u)/2,X.value=D.value,Z.value=F.exportScale,K.value=u,A.value=l,function(){if(i&&"string"==typeof i&&-1!==i.indexOf("%")){const e=i.replace("%","");i=le.value.windowWidth/100*Number(e),R.value=i}else i&&"number"==typeof i&&(R.value=i);if(c&&"string"==typeof c&&-1!==c.indexOf("%")){const e=F.imgHeight.replace("%","");c=le.value.windowHeight/100*Number(e),R.value=c}else c&&"number"==typeof c&&(R.value=Number(i))}(),se.value||(se.value=N(t.value,ie)),F.imgSrc&&de()}else me()}),{deep:!0,immediate:!0}),p((()=>F.imgSrc),(e=>{e&&de()}),{deep:!0,immediate:!0}),p((()=>H.value),(e=>{e%90&&(H.value=90*Math.round(e/90))}),{deep:!0,immediate:!0}),p((()=>q.value),(e=>{u&&clearTimeout(u),e&&(u=setTimeout((()=>{re(!1),clearTimeout(u)}),300))}),{deep:!0,immediate:!0});const ce=h((()=>g({position:"absolute",right:0,width:"56px","border-radius":"16px","font-size":"16px"}))),ne=h((()=>{const e={width:R.value?f(R.value):"auto",height:U.value?f(U.value):"auto",transform:`translate(${f(Q.value-R.value/2)}, ${f(ee.value-U.value/2)}) scale(${J.value}) rotate(${H.value}deg)`,"transition-duration":(q.value?.4:0)+"s"};return g(e)}));function re(e){q.value="boolean"==typeof e?e:e.value}function ve(e){if(!e||F.disabledRotate)return;re(!0),H.value=e;let a=R.value,l=U.value;e/90%2&&(a=U.value,l=R.value);const t=W.value/a,u=Y.value/l;J.value=Math.max(t,u),pe()}function me(){const{windowHeight:e,windowWidth:a}=m();J.value=1,H.value=0,Q.value=a/2,ee.value=e/2*n}function de(){F.imgSrc&&I({src:F.imgSrc,success:e=>{ae.value=e,function(){let e=R.value,a=U.value;if(c||i)c&&!i?(a=Number(c),e=ae.value.width/ae.value.height*a):(!c&&i||c&&i)&&(e=Number(i),a=ae.value.height/ae.value.width*e);else{const l=ae.value.width/ae.value.height;l>W.value/Y.value?(a=Y.value,e=a*l):(e=W.value,a=e/l)}const l=W.value/e,t=Y.value/a,u=Math.max(l,t);R.value=e,U.value=a,J.value=u}(),me()},fail:()=>{}})}function pe(e){const a=e||J.value;let l=Q.value,t=ee.value,u=R.value,o=U.value;H.value/90%2&&(u=U.value,o=R.value),l=u*a/2+X.value>=l?l:u*J.value/2+X.value,l=X.value+W.value-u*a/2<=l?l:X.value+W.value-u*a/2,t=o*a/2+B.value>=t?t:o*a/2+B.value,t=B.value+Y.value-o*a/2<=t?t:B.value+Y.value-o*a/2,J.value=a,ee.value=t,Q.value=l}function he(e){if(te.value=!1,1===e.touches.length)ue.value[0]={x:e.touches[0].clientX-Q.value,y:e.touches[0].clientY-ee.value};else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY);oe.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function ge(e){if(!te.value&&s)if("android"===le.value.platform?(o&&clearTimeout(o),o=setTimeout((()=>{s=!0}),25)):!s&&(s=!0),1===e.touches.length){const{x:a,y:l}=ue.value[0],t=e.touches[0].clientX-Number(a),u=e.touches[0].clientY-Number(l);Q.value=t,ee.value=u,pe()}else{const a=Math.abs(e.touches[1].clientX-e.touches[0].clientX),l=Math.abs(e.touches[1].clientY-e.touches[0].clientY),t=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=J.value*(t/Number(oe.value));J.value=Math.min(u,F.maxScale),function(){let e=R.value,a=U.value,l=J.value;H.value/90%2&&(e=U.value,a=R.value),e*l<W.value&&(l=W.value/e),a*l<Y.value&&(l=Y.value/a),pe(l)}(),oe.value=Math.sqrt(Math.pow(a,2)+Math.pow(l,2))}}function fe(){te.value=!0}function we(e){O("imgloaded",e)}function ye(e){O("imgloaderror",e)}function _e(){ve(H.value-90)}function be(){O("cancel"),O("update:modelValue",!1)}function xe(){!function(){if(!F.imgSrc)return;const e=()=>{const e=R.value*J.value*F.exportScale,a=U.value*J.value*F.exportScale,l=Q.value-X.value,u=ee.value-B.value;se.value.translate(l*F.exportScale,u*F.exportScale),F.disabledRotate||se.value.rotate(H.value*Math.PI/180),se.value.drawImage(F.imgSrc,-e/2,-a/2,e,a),se.value.restore(),se.value.draw(!1,(()=>{!function(){const{fileType:e,quality:a,exportScale:l}=F;V({width:W.value*l,height:Math.round(Y.value*l),destWidth:W.value*l,destHeight:Math.round(Y.value*l),fileType:e,quality:a,canvasId:t.value,success:e=>{const a={tempFilePath:e.tempFilePath,width:W.value*l,height:Y.value*l};O("confirm",a)},complete:()=>{O("update:modelValue",!1)}},ie)}()}))};K.value=Y.value,A.value=W.value,e()}()}function ke(){}return a({revertIsAnimation:re,setRoate:ve,resetImg:me}),(e,a)=>{const l=k,u=C,o=T;return e.modelValue?(_(),w(l,{key:0,class:j(`wd-img-cropper ${e.customClass}`),style:S(e.customStyle),onTouchmove:ke},{default:b((()=>[x(l,{class:"wd-img-cropper__wrapper"},{default:b((()=>[x(l,{class:"wd-img-cropper__cut"},{default:b((()=>[x(l,{class:j("wd-img-cropper__cut--top "+(te.value?"":"is-hightlight")),style:S(`height: ${B.value}px;`)},null,8,["class","style"]),x(l,{class:"wd-img-cropper__cut--middle",style:S(`height: ${Y.value}px;`)},{default:b((()=>[x(l,{class:j("wd-img-cropper__cut--left "+(te.value?"":"is-hightlight")),style:S(`width: ${X.value}px; height: ${Y.value}px;`)},null,8,["class","style"]),x(l,{class:"wd-img-cropper__cut--body",style:S(`width: ${W.value}px; height: ${Y.value}px;`)},{default:b((()=>[x(l,{class:"is-gridlines-x"}),x(l,{class:"is-gridlines-y"}),x(l,{class:"is-left-top"}),x(l,{class:"is-left-bottom"}),x(l,{class:"is-right-top"}),x(l,{class:"is-right-bottom"})])),_:1},8,["style"]),x(l,{class:j("wd-img-cropper__cut--right "+(te.value?"":"is-hightlight"))},null,8,["class"])])),_:1},8,["style"]),x(l,{class:j("wd-img-cropper__cut--bottom "+(te.value?"":"is-hightlight"))},null,8,["class"])])),_:1}),x(u,{prop:q.value,"change:prop":"",class:"wd-img-cropper__img",src:e.imgSrc,style:S(ne.value),"lazy-load":!1,onTouchstart:he,onTouchmove:ge,onTouchend:fe,onError:ye,onLoad:we},null,8,["prop","change:prop","src","style"])])),_:1}),x(o,{"canvas-id":t.value,id:t.value,class:"wd-img-cropper__canvas","disable-scroll":!0,style:S(`width: ${Number(A.value)*Z.value}px; height: ${Number(K.value)*Z.value}px;`)},null,8,["canvas-id","id","style"]),x(l,{class:"wd-img-cropper__footer"},{default:b((()=>[e.disabledRotate?y("",!0):(_(),w(E,{key:0,"custom-class":"wd-img-cropper__rotate",name:"rotate",onClick:_e})),x(l,{class:"wd-img-cropper__footer--button"},{default:b((()=>[x(l,{class:"is-cancel",onClick:be},{default:b((()=>[$(M(e.cancelButtonText||P(z)("cancel")),1)])),_:1}),x(G,{size:"small","custom-style":ce.value,onClick:xe},{default:b((()=>[$(M(e.confirmButtonText||P(z)("confirm")),1)])),_:1},8,["custom-style"])])),_:1})])),_:1})])),_:1},8,["class","style"])):y("",!0)}}})),[["__scopeId","data-v-96325ec1"]]),te=A(n({__name:"Index",setup(e){const{t:a}=F(),{startUpload:l,UPLOAD_STATUS:t}=ee(),{show:u}=J(),o=r(""),s=r(""),i=r(!1),c=r([!1,!1,!1]),n=r(["","",""]),v=r(["","",""]),m=r(!1),d=r(""),p=r("");function h(){U({count:1,success:e=>{const a=e.tempFilePaths[0];o.value=a,i.value=!0}})}function g(e){U({count:1,success:a=>{const l=a.tempFilePaths[0];n.value[e]=l,c.value[e]=!0}})}function f(){U({count:1,success:e=>{d.value=e.tempFilePaths[0],m.value=!0}})}function S(e){const{tempFilePath:a}=e;s.value=a}function j(e){return o=this,s=null,i=function*(){const{tempFilePath:o}=e,s={url:o,status:t.PENDING,percent:0,uid:(new Date).getTime()};try{yield l(s,{action:"https://mockapi.eolink.com/zhTuw2P8c29bc981a741931bdd86eb04dc1e8fd64865cb5/upload",onSuccess(){p.value=o,u({msg:a("shang-chuan-cheng-gong")})},onError(){u({msg:a("shang-chuan-shi-bai")})},onProgress(e){console.log("上传进度:",e.progress)}})}catch(i){console.error("上传失败:",i)}},new Promise(((e,a)=>{var l=e=>{try{u(i.next(e))}catch(l){a(l)}},t=e=>{try{u(i.throw(e))}catch(l){a(l)}},u=a=>a.done?e(a.value):Promise.resolve(a.value).then(l,t);u((i=i.apply(o,s)).next())}));var o,s,i}function C(e){console.log("加载失败",e)}function T(e){console.log("加载成功",e)}function P(e){console.log("取消",e)}function V(e){console.log("取消",e)}function I(e){const[a,l]=e.split(":").map(Number);return"1:1"===e?"200px":300*l/a+"px"}return(e,a)=>{const l=O(z("wd-img-cropper"),le),t=O(z("wd-icon"),E),u=k,r=O(z("wd-img"),K),N=O(z("demo-block"),Z),F=O(z("page-wraper"),Q);return _(),w(F,null,{default:b((()=>[x(N,{title:e.$t("jiBenYongFa"),style:{"text-align":"center"}},{default:b((()=>[x(l,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),"img-src":o.value,onConfirm:S,onCancel:P,onImgloaderror:C,onImgloaded:T},null,8,["modelValue","img-src"]),x(u,{class:"profile"},{default:b((()=>[s.value?y("",!0):(_(),w(u,{key:0,class:"img",onClick:h},{default:b((()=>[x(t,{name:"fill-camera","custom-class":"img-icon"})])),_:1})),s.value?(_(),w(r,{key:1,round:"",width:"200px",height:"200px",src:s.value,mode:"aspectFit","custom-class":"profile-img",onClick:h},null,8,["src"])):y("",!0),x(u,{style:{"font-size":"14px"}},{default:b((()=>[$(M(e.$t("dian-ji-shang-chuan-tou-xiang")),1)])),_:1})])),_:1})])),_:1},8,["title"]),x(N,{title:e.$t("zi-ding-yi-cai-jian-bi-li"),style:{"text-align":"center"}},{default:b((()=>[x(u,{class:"profile-grid"},{default:b((()=>[(_(),H(q,null,R(["3:2","16:9","16:10"],((a,o)=>x(u,{key:o,class:"profile-item"},{default:b((()=>[x(l,{modelValue:c.value[o],"onUpdate:modelValue":e=>c.value[o]=e,"img-src":n.value[o],"aspect-ratio":a,onConfirm:e=>function(e,a){const{tempFilePath:l}=a;v.value[e]=l}(o,e),onCancel:V},null,8,["modelValue","onUpdate:modelValue","img-src","aspect-ratio","onConfirm"]),v.value[o]?y("",!0):(_(),w(u,{key:0,class:"img",onClick:e=>g(o)},{default:b((()=>[x(t,{name:"fill-camera","custom-class":"img-icon"})])),_:2},1032,["onClick"])),v.value[o]?(_(),w(r,{key:1,width:"300px",height:I(a),src:v.value[o],mode:"aspectFit","custom-class":"profile-img",onClick:e=>g(o)},null,8,["height","src","onClick"])):y("",!0),x(u,{style:{"font-size":"14px"}},{default:b((()=>[$(M(a)+M(e.$t("bi-li-cai-jian")),1)])),_:2},1024)])),_:2},1024))),64))])),_:1})])),_:1},8,["title"]),x(N,{title:e.$t("cai-jian-hou-shang-chuan"),style:{"text-align":"center"}},{default:b((()=>[x(l,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),"img-src":d.value,onConfirm:j,onCancel:P},null,8,["modelValue","img-src"]),x(u,{class:"profile"},{default:b((()=>[p.value?y("",!0):(_(),w(u,{key:0,class:"img",onClick:f},{default:b((()=>[x(t,{name:"fill-camera","custom-class":"img-icon"})])),_:1})),p.value?(_(),w(r,{key:1,round:"",width:"200px",height:"200px",src:p.value,mode:"aspectFit","custom-class":"profile-img",onClick:f},null,8,["src"])):y("",!0),x(u,{style:{"font-size":"14px"}},{default:b((()=>[$(M(e.$t("dian-ji-shang-chuan-cai-jian-hou-de-tou-xiang")),1)])),_:1})])),_:1})])),_:1},8,["title"])])),_:1})}}}),[["__scopeId","data-v-7f170dc8"]]);export{te as default};
